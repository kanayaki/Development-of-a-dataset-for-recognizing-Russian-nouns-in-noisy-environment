# Разработка датасета по распознаванию русских существительных в шумных условиях

В этом репозитории представлены результаты курсовой работы 2 курса по теме "Разработка датасета по распознаванию русских существительных в шумных условиях".

## **Структура файлов:**

`informants_dataset.zip` – датасет, содержащий записи русских существительных в студийных условиях *(4805 файлов, ~437 MB)*. Записи отфильтрованы по качеству, файлы переименованы. Записи каждого информанта содержатся в отдельной папке. Все записи приведены в формате `.wav`. Также содержит файл `info.txt`, содержащий названия записей, исключенных из датасета в результате отбора. Расположен по ссылке, приведенной внизу раздела.

`informants_dataset_annotations.csv` – таблица, содержащая разметку датасета `informants_dataset.zip`. Включает соответствия следующих данных: название файла записи, название произносимого существительного, длина записи (в миллисекундах).

`informants_dataset_example` – папка, содержащая пример содержания датасета `informants_dataset.zip`. Содержит первые 20 записей информанта fa2.

`bad_quality.zip` – набор записей информантов, исключенных из датасета `informants_dataset.zip` за недостаточным качеством *(46 файлов, ~ 3 MB)*

---

`noises_dataset.zip` – датасет, содержащий записи окружающей среды (шумов) *(2000 файлов, ~619 MB)*. В записях обрезана начальная тишина, файлы переименованы. Все записи приведены в формате `.wav`. Также содержит файл `info.txt`, содержащий названия записей, повторно добавленных в датасет после удаления скриптом. Расположен по ссылке, приведенной внизу раздела.

`noises_dataset_annotations.csv` – таблица, содержащая разметку датасета `noises_dataset.zip`. Включает соответствия следующих данных: название файла записи, название категории звука, длина записи (в миллисекундах).

`noises_dataset_example` – папка, содержащая пример содержания датасета `noises_dataset.zip`. Содержит 50 записей окружающей среды (шумов).

---

**Итоговый датасет**, содержащий записи русских существительных с наложенными на них записями окружающей среды, то есть искусственный датасет с записями существительных в шумных условиях, расположен по ссылке, приведенной внизу раздела *(19 220 000 записей, ~ 1.4 TB)*. Записи каждого информанта содержатся в относящихся к нему папках и дополнительно разбиты по папкам по 100 записей. К каждому информанту относятся 6 папок, всего 54 папки. 

Папки были названы в следующем формате: 
`{кодовое_имя_информанта}_{индекс_слова_первой_записи}-{индекс_слова_последней_записи}_overlay.rar`. 

Пример названия папки: `fa2_01-101_overlay.rar`.

Полная структура датасета приведена в приложении 1 в тексте курсовой работы. Все записи приведены в формате `.wav`. Каждая из папок в датасете представлена в виде архива в формате `.rar`.

---

`final_dataset_example` – папка, содержащая пример содержания итогового датасета. Содержит наложения 50 шумов (каждое наложение в двух вариантах отступа) на запись слова "подбородок" информанта fa2.

`final_dataset_annotations.zip` – набор таблиц, содержащих разметку итогового датасета *(54 файла, ~ 137 MB)*. Каждая из таблиц содержит разметку совпадающей с ней по названию папки в составе датасета. Включает соответствия следующих данных: название файла записи, кодовое имя информанта, название произносимого существительного, название категории звука, длина записи (в миллисекундах) и позиция (в миллисекундах), с которой начинается наложение шума на запись существительного. Все таблицы приведены в формате `.csv`.

`final_dataset_annotations_example` – папка, содержащая пример содержания `final_dataset_annotations.zip`. Содержит таблицу `fa2_01_overlay.csv`, в которой представлена разметка всех записей слова "подбородок" информанта fa2, содержащихся в итоговом датасете.

---

`nouns_processing.py` – скрипт, с помощью которого производилась работа с записями существительных и связанной с ними разметкой.

`noises_processing.py` – скрипт, с помощью которого производилась работа с шумами и связанной с ними разметкой.

`overlaying.py` – скрипт, с помощью которого производилось создание итогового датасета и связанной с ним разметки.

**Ссылка на облачное хранилище, где находятся датасеты, которые невозможно выложить на github:** https://1024terabox.com/s/13O3_rV48itz_baW7XyYlow

## **Описание работы скриптов:**

При работе использовались следующие стандартные библиотеки `python`: `os` (для итерирования по папке и переименования файлов), `tqdm` (для отображения полоски прогресса), `csv` (для работы с `.csv` файлами), `random` (для получения случайного целочисленного значения).

Также, для работы с аудио использовалась библиотека `pydub`. Использовались её модули `AudioSegment` и `silence`.

1. Описание работы скрипта `nouns_processing.py`

Данный скрипт выполнял задачи переименования записей существительных и переработки разметки.

Сначала читался файл со старой разметкой. Далее, итерируясь по папке с записями, скрипт производил переименование записей, запоминая новые имена и длину записей, получаемую с помощью модуля `AudioSegment` библиотеки `pydub`. Наконец, создавался файл с новой разметкой.

Данный скрипт был выполнен отдельно для каждой папки, содержащей записи отдельного информанта, то есть он был запущен 9 раз.

2. Описание работы скрипта `noises_processing.py`

Данный скрипт выполнял задачи переименования записей шумов, их обрезки и переработки разметки.

Сначала читался файл со старой разметкой. Далее, итерируясь по папке с записями, скрипт производил переименование записей, запоминая новые имена. Также, с помощью модуля `silence` библиотеки `pydub` скрипт получал значение времени в миллисекундах, когда уровень звука в записи становился не тише установленного значения. Самым громким считается значение громкости 0. Пороговым было выбрано значение громкости -35. Скрипт двигался с шагом 1, то есть сравнивал значение в каждой секунде записи до получения нужного. Далее, скрипт обрезал запись с начала и до полученного времени и после этого считал длину записи, получаемую с помощью модуля `AudioSegment` библиотеки `pydub`. Если оказывалось так, что скрипт обрезал запись начиная от 5000 миллисекунды (то есть, убрал всю запись), то название записи выводилось. В дальнейшем такие записи были дополнительно прослушаны и повторно добавлены в датасет. Наконец, создавался файл с новой разметкой. 

3. Описание работы скрипта `overlaying.py`

Данный скрипт выполнял задачи наложения шумов на записи существительных и создания их разметки. 

Скрипт итерировался по папке с записями существительных и, на каждом шаге этого цикла, итерировался по папке с записями шумов. Для начала он получал длину записи существительного, получаемую с помощью модуля `AudioSegment` библиотеки `pydub`. Далее, он считал значение, составляющее 60% от общей длины записи в миллисекундах, и вычислял два случайных целочисленных значения, лежащих в пределах от 0 до вычисленного ранее значения. Затем, скрипт два раза производил наложение шума на запись существительного начиная с значения времени в миллисекундах, равного вычисленному ранее случайному числу. Первой записи присваивался индекс наложения A, второй записи – индекс наложения B. Далее скрипт производил переименование записей, запоминая новые имена и всю соответствующую метаинформацию. Наконец, создавался файл с новой разметкой.

### Как запускать скрипты

Для того, чтобы запустить скрипт, следует в коде заполнить переменные, в которые записывались пути к папкам, нужными путями. Также стоит раскомментировать строчки кода, про которые сказано в комментариях, и дополнить их до нужных путей.
